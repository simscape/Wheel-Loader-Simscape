<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Wheel Loader with Hydromechanical Power Split Transmission</title>
<meta name="generator" content="MATLAB 25.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-10-31">
<meta name="DC.source" content="sm_wheel_loader.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Wheel Loader with Hydromechanical Power Split Transmission</h1>
<!--introduction-->
<p>
<img vspace="5" hspace="5" src="sm_wheel_loader_Overview.png" alt=""> </p>
<p>(<a href="matlab:web('Wheel_Loader_Design_Overview.html')">return to Wheel Loader Design with Simscape Overview</a>)</p>
<p>This example models a wheel loader with a power-split hydromechanical continuously variable transmission (CVT. Other CVT technologies can be tested as well, including pure hydrostatic and electrical CVT. The engine, CVT, driveline, chassis, and linkage system are all modeled using Simscape. The control systems are modeled in Simulink. A bucket or a grapple can be attached to the linkage.</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Model</a>
</li>
<li>
<a href="#2">Wheel Loader Subsystem</a>
</li>
<li>
<a href="#3">Transmission Variant Subsystems</a>
</li>
<li>
<a href="#4">Abstract CVT Subsystem</a>
</li>
<li>
<a href="#5">Hydrostatic Transmission Subsystem</a>
</li>
<li>
<a href="#6">Electrical Transmission Subsystem</a>
</li>
<li>
<a href="#7">Power Split Hydromechanical CVT Subsystem</a>
</li>
<li>
<a href="#8">Vehicle Subsystem</a>
</li>
<li>
<a href="#9">Actuator Subsystem: Hydraulic</a>
</li>
<li>
<a href="#10">Driveline 3D Subsystem</a>
</li>
<li>
<a href="#11">Driveline 1D Subsystem</a>
</li>
<li>
<a href="#12">Linkage Subsystem</a>
</li>
<li>
<a href="#13">Simulation Results: Y Cycle, Droop Control, <b>Power-Split CVT</b>, 1D Driveline, Bucket, Ideal Actuation</a>
</li>
<li>
<a href="#15">Simulation Results: Y Cycle, Droop Control, Abstract CVT, 1D Driveline, Bucket, Ideal Actuation</a>
</li>
<li>
<a href="#17">Simulation Results: Y Cycle, Droop Control, Electrical CVT, 1D Driveline, Bucket, Ideal Actuation</a>
</li>
<li>
<a href="#19">Simulation Results: Y Cycle, Droop Control, Hydrostatic CVT, 1D Driveline, Bucket, Ideal Actuation</a>
</li>
<li>
<a href="#21">Comparison of CVT Models</a>
</li>
<li>
<a href="#22">Simulation Results: Y Cycle, Droop Control, <b>Power-Split CVT</b>, 1D Driveline, Bucket, <b>Hydraulic Actuation</b></a>
</li>
</ul>
</div>
<h2 id="1">Model</h2>
<p>This example models a wheel loader with a power-split hydromechanical continuously variable transmission (CVT).</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');">Open Model</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_01.png" alt=""> <h2 id="2">Wheel Loader Subsystem</h2>
<p>The wheel loader is powered by an engine. The continuously variable transmission varies its ratio to drive the vehicle at the desired speed. The vehicle includes the driveline, articulated chassis, and linkage which operates the implements.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_02.png" alt=""> <h2 id="3">Transmission Variant Subsystems</h2>
<p>Four options for modeling the CVT are included in the model. Using variant subsystems, one of them can be activated for a test. The subsystems all have the same interface, which includes a mechanical connection to the engine and a mechanical connection to the driveline. Intefaces based on physical connections are particularly well-suited to swapping between models of different technologies or fidelity.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_03.png" alt=""> <h2 id="4">Abstract CVT Subsystem</h2>
<p>Models a CVT as a variable ratio gear. This model can be used in early stages of development to refine requirements for the transmission. It can also be tuned to match a more detailed model of the CVT so as to provide accurate behavior with less computation.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Abstract','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_04.png" alt=""> <h2 id="5">Hydrostatic Transmission Subsystem</h2>
<p>Hydrostatic transmission with variable-displacement pump and fixed-displacement motor. This system alone can also serve as a CVT, but it is not as efficient as the power-split design, as the mechanical path has a higher efficiency.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Hydrostatic/Hydrostatic','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_05.png" alt=""> <h2 id="6">Electrical Transmission Subsystem</h2>
<p>Electrical transmission with generator, motor, and battery. A control system adjusts the power flow between the motor and the generator. The control system enables these components to act as a variable ratio transmission.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Electrical','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_06.png" alt=""> <h2 id="7">Power Split Hydromechanical CVT Subsystem</h2>
<p>Transmission with four planetary gears, clutches, and a parallel power path through a hydrostatic transmission. A hydraulic regenerative braking system is also included to improve fuel economy by storing kinetic energy as pressure in an accumulator.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Power%20Split%20Hydromech','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_07.png" alt=""> <h2 id="8">Vehicle Subsystem</h2>
<p>Model of the wheel loader vehicle, including front and rear articulated chassis, driveline, and linkage. An optional load can be added using variant subsystems.</p>
<p>The fidelity level of the mechanical driveline model can be set to different options:</p>
<div>
<ul>
<li>
<b>Driveline 1D</b> : Shafts are modeled as rotational inertias only. Simulation runs very quickly.</li>
<li>
<b>Driveline 3D</b> : Shafts are modeled with a 3D multibody model. Captures all rigid body dynamics of the system.</li>
</ul>
</div>
<p>The actuation model for the steering, linkage, and implements can be configured to use the following options</p>
<div>
<ul>
<li>
<b>Ideal</b>: Cylinder positions are set using prescribed motion. Simulation runs very quickly. Used to determine actuator requirements.</li>
<li>
<b>Hydraulic</b>: Hydraulic pumps, valves, and cylinders are used to model the actuation system. Used to select hydraulic components and set pressure levels.</li>
</ul>
</div>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_08.png" alt=""> <h2 id="9">Actuator Subsystem: Hydraulic</h2>
<p>In this configuration the cylinders are actuated by a hydraulic system. Pumps are driven by the PTO shaft, one for the linkage and implements and another for the steering system. Valves control the flow of hydraulic fluid to the actuators which extend and contract to the desired position.</p>
<p>The interface from this 1D model of the hydromechanical system and the 3D multibody of the linkage is a 1D mechanical connection for the rod of each cylinder.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Actuators/Hydraulic','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_09.png" alt=""> <h2 id="10">Driveline 3D Subsystem</h2>
<p>Models a four-wheel drive driveline using parts imported from a CAD assembly. The output of the CVT connects to the output transfer gear which is connected via differentials to all four wheels. A separate variant models the driveline as a 1D mechanical model that can be used for exploring the design space of shaft sizes and gear ratios.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Driveline/Driveline/Driveline%203D','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_10.png" alt=""> <h2 id="11">Driveline 1D Subsystem</h2>
<p>Models a four-wheel drive driveline using parts imported from a CAD assembly. The output of the CVT connects to the output transfer gear which is connected via differentials to all four wheels. A separate variant models the driveline as a 1D mechanical model that can be used for exploring the design space of shaft sizes and gear ratios.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Driveline/Driveline/Driveline%201D/Driveline','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_11.png" alt=""> <h2 id="12">Linkage Subsystem</h2>
<p>Models the linkage subsystem for actuating the implement. Lift and tilt actuators actuate the linkage to raise and lower the implement. The implement can be configured to a bucket or a grapple using variant subsystems.</p>
<p>
<a href="matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Linkage','force');">Open Subsystem</a>
</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_12.png" alt=""> <h2 id="13">Simulation Results: Y Cycle, Droop Control, <b>Power-Split CVT</b>, 1D Driveline, Bucket, Ideal Actuation</h2>
<p>The results below come from a simulation test where the wheel loader completes a standard Y-cycle with a power-split CVT.</p>
<pre class="codeoutput">Elapsed Sim Time = 75.1056
</pre>
<img vspace="5" hspace="5" src="sm_wheel_loader_13.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_14.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_15.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_16.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_17.png" alt=""> <h2 id="15">Simulation Results: Y Cycle, Droop Control, Abstract CVT, 1D Driveline, Bucket, Ideal Actuation</h2>
<p>The results below come from a simulation test where the wheel loader completes a standard Y-cycle. The CVT is modeled abstractly as a variable ratio gear.</p>
<pre class="codeoutput">Elapsed Sim Time = 21.6261
</pre>
<img vspace="5" hspace="5" src="sm_wheel_loader_18.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_19.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_20.png" alt=""> <h2 id="17">Simulation Results: Y Cycle, Droop Control, Electrical CVT, 1D Driveline, Bucket, Ideal Actuation</h2>
<p>The results below come from a simulation test where the wheel loader completes a standard Y-cycle with an electrical CVT.</p>
<pre class="codeoutput">Elapsed Sim Time = 20.7649
</pre>
<img vspace="5" hspace="5" src="sm_wheel_loader_21.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_22.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_23.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_24.png" alt=""> <h2 id="19">Simulation Results: Y Cycle, Droop Control, Hydrostatic CVT, 1D Driveline, Bucket, Ideal Actuation</h2>
<p>The results below come from a simulation test where the wheel loader completes a standard Y-cycle with an electrical CVT.</p>
<pre class="codeoutput">Elapsed Sim Time = 44.7523
</pre>
<img vspace="5" hspace="5" src="sm_wheel_loader_25.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_26.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_27.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_28.png" alt=""> <h2 id="21">Comparison of CVT Models</h2>
<p>The following plot compares the input torque for tests with the power split CVT, electrical, and the abstract CVT models.</p>
<img vspace="5" hspace="5" src="sm_wheel_loader_29.png" alt=""> <h2 id="22">Simulation Results: Y Cycle, Droop Control, <b>Power-Split CVT</b>, 1D Driveline, Bucket, <b>Hydraulic Actuation</b>
</h2>
<p>The results below come from a simulation test where the wheel loader completes a standard Y-cycle. The power-split CVT is included and the linkage and steering actuation is modeled as a hydraulic network.</p>
<pre class="codeoutput">Elapsed Sim Time = 510.8051
</pre>
<img vspace="5" hspace="5" src="sm_wheel_loader_30.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_31.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_32.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_33.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_34.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_35.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_36.png" alt=""> <img vspace="5" hspace="5" src="sm_wheel_loader_37.png" alt=""> <p class="footer">Copyright 2023-2025 The MathWorks, Inc.<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2025a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Wheel Loader with Hydromechanical Power Split Transmission
% 
% <<sm_wheel_loader_Overview.png>>
%
% (<matlab:web('Wheel_Loader_Design_Overview.html') return to Wheel Loader Design with Simscape Overview>)
% 
% This example models a wheel loader with a power-split hydromechanical
% continuously variable transmission (CVT. Other CVT technologies can be
% tested as well, including pure hydrostatic and electrical CVT. The
% engine, CVT, driveline, chassis, and linkage system are all modeled using
% Simscape.  The control systems are modeled in Simulink.  A bucket or a
% grapple can be attached to the linkage.
%
% Copyright 2023-2025 The MathWorks, Inc.

%% Model
%
% This example models a wheel loader with a power-split hydromechanical
% continuously variable transmission (CVT).
%
% <matlab:open_system('sm_wheel_loader'); Open Model>

open_system('sm_wheel_loader')
set_param(bdroot,'LibraryLinkDisplay','none')
ann_h = find_system('sm_wheel_loader','MatchFilter',@Simulink.match.allVariants,'FindAll', 'on','type','annotation','Tag','ModelFeatures');
for anhi=1:length(ann_h)
    set_param(ann_h(anhi),'Interpreter','off');
end

set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Power Split Hydromechanical')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Hydraulic')

%% Wheel Loader Subsystem
%
% The wheel loader is powered by an engine.  The continuously variable
% transmission varies its ratio to drive the vehicle at the desired speed.
% The vehicle includes the driveline, articulated chassis, and linkage
% which operates the implements.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader','force'); Open Subsystem>

set_param('sm_wheel_loader/Wheel Loader','LinkStatus','none')
open_system('sm_wheel_loader/Wheel Loader','force')
%set_param(find_system('sm_wheel_loader/Wheel Loader','MatchFilter',@Simulink.match.allVariants,'FindAll', 'on','type','annotation','Tag','ModelFeatures'),'Interpreter','off')

%% Transmission Variant Subsystems
%
% Four options for modeling the CVT are included in the model.  Using
% variant subsystems, one of them can be activated for a test.  The
% subsystems all have the same interface, which includes a mechanical
% connection to the engine and a mechanical connection to the driveline.
% Intefaces based on physical connections are particularly well-suited to
% swapping between models of different technologies or fidelity.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission','force'); Open Subsystem>

set_param('sm_wheel_loader/Wheel Loader/Transmission','LinkStatus','none')
open_system('sm_wheel_loader/Wheel Loader/Transmission','force')

%% Abstract CVT Subsystem
%
% Models a CVT as a variable ratio gear. This model can be used in early
% stages of development to refine requirements for the transmission.  It
% can also be tuned to match a more detailed model of the CVT so as to
% provide accurate behavior with less computation.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Abstract','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_cvt','Abstract')
set_param([bdroot '/Wheel Loader/Transmission/Abstract'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Transmission/Abstract'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Hydrostatic Transmission Subsystem
%
% Hydrostatic transmission with variable-displacement pump and
% fixed-displacement motor.  This system alone can also serve as a CVT, but
% it is not as efficient as the power-split design, as the mechanical path
% has a higher efficiency.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Hydrostatic/Hydrostatic','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_cvt','Hydrostatic')
set_param([bdroot '/Wheel Loader/Transmission/Hydrostatic/Hydrostatic'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Transmission/Hydrostatic/Hydrostatic'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Electrical Transmission Subsystem
%
% Electrical transmission with generator, motor, and battery.  A control
% system adjusts the power flow between the motor and the generator.  The
% control system enables these components to act as a variable ratio
% transmission.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Electrical','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_cvt','Electrical')
set_param([bdroot '/Wheel Loader/Transmission/Electrical'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Transmission/Electrical'],'force')
set_param(bdroot,'SimulationCommand','update')


%% Power Split Hydromechanical CVT Subsystem
%
% Transmission with four planetary gears, clutches, and a parallel power
% path through a hydrostatic transmission. A hydraulic regenerative braking
% system is also included to improve fuel economy by storing kinetic energy
% as pressure in an accumulator.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Transmission/Power%20Split%20Hydromech','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_cvt','Power Split Hydromechanical')
set_param([bdroot '/Wheel Loader/Transmission/Power Split Hydromech'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Transmission/Power Split Hydromech'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Vehicle Subsystem
%
% Model of the wheel loader vehicle, including front and rear articulated
% chassis, driveline, and linkage.  An optional load can be added using
% variant subsystems.  
% 
% The fidelity level of the mechanical driveline model can be set to
% different options:
%
% * *Driveline 1D* : Shafts are modeled as rotational inertias only.
% Simulation runs very quickly.
% * *Driveline 3D* : Shafts are modeled with a 3D multibody model.
% Captures all rigid body dynamics of the system.
%
% The actuation model for the steering, linkage, and implements can be
% configured to use the following options
%
% * *Ideal*: Cylinder positions are set using prescribed motion.
% Simulation runs very quickly.  Used to determine actuator requirements.
% * *Hydraulic*: Hydraulic pumps, valves, and cylinders are used to
% model the actuation system.  Used to select hydraulic components and set
% pressure levels.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader/Vehicle'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Vehicle'],'force')

%% Actuator Subsystem: Hydraulic
%
% In this configuration the cylinders are actuated by a hydraulic system.
% Pumps are driven by the PTO shaft, one for the linkage and implements and
% another for the steering system. Valves control the flow of hydraulic
% fluid to the actuators which extend and contract to the desired position.
%
% The interface from this 1D model of the hydromechanical system and the 3D
% multibody of the linkage is a 1D mechanical connection for the rod of
% each cylinder.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Actuators/Hydraulic','force'); Open Subsystem>

set_param('sm_wheel_loader/Wheel Loader/Vehicle/Actuators/Hydraulic','LinkStatus','none')
open_system('sm_wheel_loader/Wheel Loader/Vehicle/Actuators/Hydraulic','force')

%% Driveline 3D Subsystem
%
% Models a four-wheel drive driveline using parts imported from a CAD
% assembly.  The output of the CVT connects to the output transfer gear
% which is connected via differentials to all four wheels.  A separate
% variant models the driveline as a 1D mechanical model that can be used
% for exploring the design space of shaft sizes and gear ratios.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Driveline/Driveline/Driveline%203D','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_driveline','3D, U Joints')
set_param([bdroot '/Wheel Loader/Vehicle/Driveline/Driveline/Driveline 3D'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Vehicle/Driveline/Driveline/Driveline 3D'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Driveline 1D Subsystem
%
% Models a four-wheel drive driveline using parts imported from a CAD
% assembly.  The output of the CVT connects to the output transfer gear
% which is connected via differentials to all four wheels.  A separate
% variant models the driveline as a 1D mechanical model that can be used
% for exploring the design space of shaft sizes and gear ratios.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Driveline/Driveline/Driveline%201D/Driveline','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints')
set_param([bdroot '/Wheel Loader/Vehicle/Driveline/Driveline/Driveline 1D/Driveline'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Vehicle/Driveline/Driveline/Driveline 1D/Driveline'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Linkage Subsystem
%
% Models the linkage subsystem for actuating the implement.  Lift and tilt
% actuators actuate the linkage to raise and lower the implement.  The
% implement can be configured to a bucket or a grapple using variant
% subsystems.
%
% <matlab:open_system('sm_wheel_loader');open_system('sm_wheel_loader/Wheel%20Loader/Vehicle/Linkage','force'); Open Subsystem>

set_param([bdroot '/Wheel Loader'],'popup_driveline','3D, U Joints')
set_param([bdroot '/Wheel Loader/Vehicle/Linkage'],'LinkStatus','none')
open_system([bdroot '/Wheel Loader/Vehicle/Linkage'],'force')
set_param(bdroot,'SimulationCommand','update')

%% Simulation Results: Y Cycle, Droop Control, *Power-Split CVT*, 1D Driveline, Bucket, Ideal Actuation
%%
%
% The results below come from a simulation test where the wheel loader
% completes a standard Y-cycle with a power-split CVT.
%

set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Power Split Hydromechanical')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Ideal')

sim('sm_wheel_loader');

sm_wheel_loader_plot1whlspd(simlog_sm_wheel_loader,HMPST.Tire.Rad)
sm_wheel_loader_plot2vehpos(simlog_sm_wheel_loader)
sm_wheel_loader_plot3clutches(simlog_sm_wheel_loader.Wheel_Loader.Transmission)
sm_wheel_loader_plot4linkage(logsout_sm_wheel_loader.get('mVehicle').Values)
sm_wheel_loader_plot5steer(simlog_sm_wheel_loader.Wheel_Loader,logsout_sm_wheel_loader.get('mVehicle').Values)

% Get engine torque data
trqCVT = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.values('N*m');
timCVT = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.time;

%% Simulation Results: Y Cycle, Droop Control, Abstract CVT, 1D Driveline, Bucket, Ideal Actuation
%%
%
% The results below come from a simulation test where the wheel loader
% completes a standard Y-cycle.  The CVT is modeled abstractly as a
% variable ratio gear.
%

set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Abstract')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Ideal')
sim('sm_wheel_loader');

sm_wheel_loader_plot1whlspd(simlog_sm_wheel_loader,HMPST.Tire.Rad)
sm_wheel_loader_plot2vehpos(simlog_sm_wheel_loader)
sm_wheel_loader_plot5steer(simlog_sm_wheel_loader.Wheel_Loader,logsout_sm_wheel_loader.get('mVehicle').Values)

% Get engine torque data
trqAbs = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.values('N*m');
timAbs = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.time;

%% Simulation Results: Y Cycle, Droop Control, Electrical CVT, 1D Driveline, Bucket, Ideal Actuation
%%
%
% The results below come from a simulation test where the wheel loader
% completes a standard Y-cycle with an electrical CVT.
%

set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Electrical')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Ideal')
sim('sm_wheel_loader');

sm_wheel_loader_plot1whlspd(simlog_sm_wheel_loader,HMPST.Tire.Rad)
sm_wheel_loader_plot2vehpos(simlog_sm_wheel_loader)
sm_wheel_loader_plot5steer(simlog_sm_wheel_loader.Wheel_Loader,logsout_sm_wheel_loader.get('mVehicle').Values)
ssc_hydromech_power_split_cvt_plot4ecvtcurrent(simlog_sm_wheel_loader.Wheel_Loader.Transmission)

% Get engine torque data
trqEle = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.values('N*m');
timEle = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.time;

%% Simulation Results: Y Cycle, Droop Control, Hydrostatic CVT, 1D Driveline, Bucket, Ideal Actuation
%%
%
% The results below come from a simulation test where the wheel loader
% completes a standard Y-cycle with an electrical CVT.
%

set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Hydrostatic')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Ideal')
sim('sm_wheel_loader');

sm_wheel_loader_plot1whlspd(simlog_sm_wheel_loader,HMPST.Tire.Rad)
sm_wheel_loader_plot2vehpos(simlog_sm_wheel_loader)
sm_wheel_loader_plot5steer(simlog_sm_wheel_loader.Wheel_Loader,logsout_sm_wheel_loader.get('mVehicle').Values)
ssc_hydromech_power_split_cvt_plot2pressure(simlog_sm_wheel_loader.Wheel_Loader.Transmission)

% Get engine torque data
trqHst = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.values('N*m');
timHst = simlog_sm_wheel_loader.Wheel_Loader.Engine.Engine_Droop.Torque_Sensor.Torque_Sensor.t.series.time;


%% Comparison of CVT Models
%
% The following plot compares the input torque for tests with the power
% split CVT, electrical, and the abstract CVT models.

figure(44)
temp_colororder = get(gca,'defaultAxesColorOrder');

plot(timCVT,trqCVT,'-.','LineWidth',1,'DisplayName','Power Split');
hold on
plot(timAbs,trqAbs,'LineWidth',2,'DisplayName','Abstract');
plot(timHst,trqHst,":",'LineWidth',2,'DisplayName','Hydrostatic');
plot(timEle,trqEle,'-.','LineWidth',2,'DisplayName','Electrical');
hold off
ylabel('CVT Input Torque (N*m)')
xlabel('Time (s)');
legend('Location','Best')
yRange = abs(max(trqAbs)-min(trqAbs));
set(gca,'YLim',[min(trqAbs)-0.1*yRange max(trqAbs)+0.1*yRange])
title('Comparison of CVT Models')

%% Simulation Results: Y Cycle, Droop Control, *Power-Split CVT*, 1D Driveline, Bucket, *Hydraulic Actuation*
%%
%
% The results below come from a simulation test where the wheel loader
% completes a standard Y-cycle. The power-split CVT is included and the
% linkage and steering actuation is modeled as a hydraulic network.
%

close(44)
set_param([bdroot '/Wheel Loader'],'popup_engine','Droop');
set_param([bdroot '/Wheel Loader'],'popup_driveline','1D, CV Joints');
sm_wheel_loader_config_impl(bdroot,'Bucket')
set_param([bdroot '/Wheel Loader'],'popup_cvt','Power Split Hydromechanical')
set_param([bdroot '/Wheel Loader'],'popup_actuator_model','Hydraulic')

sim('sm_wheel_loader');

sm_wheel_loader_plot1whlspd(simlog_sm_wheel_loader,HMPST.Tire.Rad)
sm_wheel_loader_plot2vehpos(simlog_sm_wheel_loader)
sm_wheel_loader_plot3clutches(simlog_sm_wheel_loader.Wheel_Loader.Transmission)
sm_wheel_loader_plot4linkage(logsout_sm_wheel_loader.get('mVehicle').Values)
sm_wheel_loader_plot5steer(simlog_sm_wheel_loader.Wheel_Loader,logsout_sm_wheel_loader.get('mVehicle').Values)
sm_wheel_loader_plot6linkagehydr(simlog_sm_wheel_loader.Wheel_Loader.Vehicle.Actuators.Hydraulic)
sm_wheel_loader_plot7steerhydr(simlog_sm_wheel_loader.Wheel_Loader.Vehicle.Actuators.Hydraulic)

%%

close all
bdclose('sm_wheel_loader');

##### SOURCE END #####
-->
</body>
</html>
